<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>logrotate | Sleep Bear&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="logrotate 配置logrotate使用简单，直接在/etc/logrotate.d/ 下添加一个配置文件即可，以apache httpd 为例：1/var/log/httpd/*log &amp;#123;&amp;#10;&amp;#9; missingok&amp;#10;&amp;#9; notifempty&amp;#10;&amp;#9; sharedscripts&amp;#10;&amp;#9; delaycompress&amp;#10;&amp;#9; po">
<meta property="og:type" content="article">
<meta property="og:title" content="logrotate">
<meta property="og:url" content="http://www.sleepbear.com/2015/09/16/logrotate/index.html">
<meta property="og:site_name" content="Sleep Bear's blog">
<meta property="og:description" content="logrotate 配置logrotate使用简单，直接在/etc/logrotate.d/ 下添加一个配置文件即可，以apache httpd 为例：1/var/log/httpd/*log &amp;#123;&amp;#10;&amp;#9; missingok&amp;#10;&amp;#9; notifempty&amp;#10;&amp;#9; sharedscripts&amp;#10;&amp;#9; delaycompress&amp;#10;&amp;#9; po">
<meta property="og:updated_time" content="2015-09-16T02:31:37.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="logrotate">
<meta name="twitter:description" content="logrotate 配置logrotate使用简单，直接在/etc/logrotate.d/ 下添加一个配置文件即可，以apache httpd 为例：1/var/log/httpd/*log &amp;#123;&amp;#10;&amp;#9; missingok&amp;#10;&amp;#9; notifempty&amp;#10;&amp;#9; sharedscripts&amp;#10;&amp;#9; delaycompress&amp;#10;&amp;#9; po">
  
    <link rel="alternative" href="/atom.xml" title="Sleep Bear&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Sleep Bear&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.sleepbear.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-logrotate" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/09/16/logrotate/" class="article-date">
  <time datetime="2015-09-16T02:10:03.000Z" itemprop="datePublished">2015-09-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      logrotate
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="logrotate_配置">logrotate 配置</h3><p>logrotate使用简单，直接在/etc/logrotate.d/ 下添加一个配置文件即可，以apache httpd 为例：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/log/httpd/*log &#123;&#10;&#9; missingok&#10;&#9; notifempty&#10;&#9; sharedscripts&#10;&#9; delaycompress&#10;&#9; postrotate&#10;&#9;&#9;  /bin/systemctl reload httpd.service &#62; /dev/null 2&#62;/dev/null || true&#10;&#9; endscript&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>logrotate的配置很简答，但需注意：</p>
<ol>
<li><p>logrotate默认是一天执行一次，在/etc/cron.daily/logrotate 有其执行脚本，作为定时任务执行。可以通过执行logrotate /etc/logrotate.conf 来手动执行rotate，注意，-f 是–force的意思，而不是–file的意思，使用-f 会强制执行生成新的rotate.<br><em>Normally, logrotate is run as a daily cron job. It will not modify a log multiple times in one day unless the criterion for that log is based on the log’s size and logrotate is being run multiple times each day, or unless the -f or –force option is used.</em></p>
</li>
<li><p>另外，logrotate 本身没有daemon 在运行，其执行必须要等到某个地方调用logrotate才会跑，正常情况下只有手动调用logrotate命令或者到/etc/cron.daily下的定时任务执行的时候才会执行。</p>
</li>
</ol>
<h3 id="weekly、daily、size、minsize_的关系">weekly、daily、size、minsize 的关系</h3><ul>
<li>若未使用weekly、daily等时间中的任何一个，由于/etc/logrotate.conf中定义了weekly，因此默认会采用weekly，后面的配置会覆盖前面的配置</li>
<li>daily、weekly是通过生成的上个rotate文件的创建时间来确定下一个打包时间的，若当前进行rotate的时间与上一次打包的时间间隔超过了设置的时间间隔(daily)，则会进行rotate，否则不会。</li>
<li>size：若采用了size，会优先根据size的大小来进行rotate，只要当前日志文件的size超过了设定的size，则会进行打包，而不管是否达到了daily所设定的时间间隔。</li>
<li><p>minsize： manual手册是这么解释的：<br> <strong>minsize size</strong><br> <em>Log files are rotated when they grow bigger than size bytes, but not before the additionally specified time interval (daily, weekly, monthly, or yearly). The related size option is similar except that it is mutually exclusive with the time interval options, and it causes log files to be rotated without regard for the last rotation time. When minsize is used, both the size and timestamp of a log file are considered.</em></p>
<p> 意思是，minsize既考虑日志文件的大小，又考虑时间间隔，必须等两者均满足条件时才会执行。<br> 与size不同的地方就在于此，size是只要大小超过限制，则只要logrotate被调用便会执行，而minsize必须要大小超过限制且距离上次打包时间超过间隔时间才会打包。</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.sleepbear.com/2015/09/16/logrotate/" data-id="cifwmblwf000j0ax22vhslzb2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/09/19/hello-world/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Hello World
        
      </div>
    </a>
  
  
    <a href="/2015/09/13/中秋国庆川西甘南/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">中秋国庆川西甘南</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/netlink/">netlink</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shadowsocks/">shadowsocks</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/skb/">skb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/">test</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/travelling/">travelling</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/netlink/" style="font-size: 20px;">netlink</a> <a href="/tags/shadowsocks/" style="font-size: 10px;">shadowsocks</a> <a href="/tags/skb/" style="font-size: 10px;">skb</a> <a href="/tags/test/" style="font-size: 10px;">test</a> <a href="/tags/travelling/" style="font-size: 10px;">travelling</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/10/18/shadowsock-小米路由器/">shadowsocks 小米路由器</a>
          </li>
        
          <li>
            <a href="/2015/10/12/genetlink/">genetlink.md</a>
          </li>
        
          <li>
            <a href="/2015/10/09/skb/">SKB</a>
          </li>
        
          <li>
            <a href="/2015/09/25/netlink-message-data-structure/">netlink message data structure</a>
          </li>
        
          <li>
            <a href="/2015/09/23/write-a-kernel-user-netlink-application/">write a kernel-user netlink application</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 dusk lee<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="./js/jquery-1.8.2.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>